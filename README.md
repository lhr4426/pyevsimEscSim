# pyevsimEscSim

일단 뭐라도 하자
1. 10 * 10 크기의 맵을 만든다
2. 일단 한 모델이라도 만들어서 랜덤으로 이동하게 한다
3. 가장 빠른 시간 내에 탈출하는게 목표임

Game Model
init : 맵을 만들고 탈출구를 설정함
NPC Gen : NPC들을 
만듬


NPC Model
init : 초기 위치, 이동 큐를 만듬

게임 규칙
1. 처음에 500점으로 시작함
2. 한 턴이 지날때마다 1씩 빠짐
3. 다른 유닛이랑 부딛치면 50씩 빠짐
4. 가장 많은 점수가 남아야됨
5. 그리드세계 밖으로 나가면 50씩 빠짐
6. 제대로 문으로 탈출하면 +100점

### 07.17 만든 내용
- 게임 모델이랑 NPC 모델 틀만 짜둠
- 게임 모델은 생성시 바로 맵 만들고 NPC 생성해서 엮음
- 이때 NPC들이 처음부터 부딛치지 않도록, 게임모델이 위치정보를 다 가지고있도록 함

#### 내일 해야할거
- 선택 큐 만들어서 어떻게 움직였는지 확인해야함
- 가장 높은 선택을 잇도록 해야함

### 07.19 만든 내용
- 이동 로그랑 점수 로그 만듬 (NPCModel.move_log랑 score_log)
- 에포크 기능 추가
- 이제 움직이는거까지는 어떻게 됨 
- 에포크 여러번일때 마지막 점수가 최고였던 결과를 따라가도록 함 (NPCModel.make_choice())
- 근데 무조건은 아니고 확률적으로 따라가도록
- 가장 점수가 높았던 이동 로그를 txt파일로 남기도록 했음 (GameModel에서)
- 의미없이 반대 방향으로 가는걸 막음 (NPCModel.remove_opposite_move())
- 위의 함수 만들어서 조금 성능이 괜찮아진거같음

### 발견된 문제점
- 최종 점수가 가장 높은 이동 로그를 따라가다보니까 늘 최선의 선택은 아닐수 있음
- 매 회차에서 해당 이동순서 기준 가장 좋은 선택을 해야할지 고민중
- 같은 점수라면 더 짧은 이동횟수로 문까지 도달한게 더 좋은 결과임
- 생각보다 정확도가 많이 떨어짐;

### 해결된 문제점
- 맵을 매번 새로 그릴건데, 배경 맵이랑 그린 후의 맵이 주소가 똑같아서 초기화가 안됨
- 매번 새로그리는 대신 이전 위치부분을 'ㅁ'로 다시 바꾸는걸로 해결함

#### 내일 해야할거
- 여러 유닛들을 생성해서 잘 되나 해봐야함

### 07.20 만든 내용
- 구조 좀 깔끔하게 다시 정리해야될듯;
- 1 에포크 시작할때 GameModel이 NPCModel한테 신호를 주는건 필요함
- 이동횟수 다하거나 방 탈출했을때 NPCModel이 GameModel한테 Epoch_end를 보내야할까?
- 뭔가 이상함 다시짜야될거같음 -> 0720_new에 다시짰음 내일 내로 문제 발견 안되면 예전버전 지울거임
- 돌아가기는 하는데 자꾸 동시에 도착할때 멈춰버림

### 07.21 만든 내용
- 충돌감지 바꾸는중 -> 성공
- 어찌저찌 돌아가기는 함
- Result.txt를 읽어서 움직임을 재현하게 하는것도 있으면 좋을거같은데
- 그럴거면 json으로 저장하는게 나은지 고민중 -> json 파싱으로 결과 출력하는 ResultViewer 생성
- 일단 에이전트 10개까지는 테스트해봤고 탈출은 못해도 일단 돌아는 감
- 이전버전 삭제함

#### 발견된 문제점
- 탈출 했는데 안했다고뜸;
- 에포크가 안넘어감.. 왜인지 모르겠음
- ended_agent 안에 있는 애들한테는 move 신호를 안주고싶은데 선택적으로 줄 수 있는지 모르겠음

#### 해결된 문제점
- 오늘 발견한건 다 해결함
- 탈출 했는데 안했다고뜸 -> 저장 시점이 잘못됨
- 에포크가 안넘어감 -> 조기탈출 했을때 꼬였던거 품
- ended_agent 안에 있는 애들만 선택적으로 -> ended_agent 자체를 move msg 안에 넣어서 
- 자기가 그 안에 있으면 안움직이게 바꿈

### 07.24 만든 내용
- 가능하면 ResultViewer 모델이랑 GameModel을 합치고싶은데..
- 중간에 VIRTUAL TIME에서 REAL TIME으로 바꿀 수 있는지 확인해봐야겠음 (test.py)
- 성공함! 중간에 REALTIME으로 바꿀 수 있음!
- 그럼 이제 GameModel에서 Result.json이 생성되면 그걸 읽도록 ResultViewer랑 연결지어야겠음
- 성공함!
- 뭔가 탈출했을 때 이득이 너무 적은거같아서 1000으로 올림
- 점수 계산방법이 잘못되었길래 고쳤음 (점수보다 일단 나간거 우선으로)
- 계산방법 고치니까 이전보다 좀 잘 탈출하는듯

#### 발견된 문제점
- 이 시뮬레이션 자체를 넓게 봐야할지 좁게 봐야할지 모르겠음
- 지금의 방법으로는 에이전트 하나하나가 잘 나가는 Best를 찾는 수준인데
- 그러면 최적의 방법으로 각자 나가다가 또 부딛칠수도 있음 -> 실제로 돌려보니까 진짜 지들끼리 부딛침
- 근데 결국 넓게 보려면 서로가 서로의 위치를 알아야한다는건데...
- 왜 에이전트 수가 늘수록 시작점수가 499로 찍히는게 아니라 399로 찍히는지 모르겠음
- 에이전트 기준이 아니라 게임 기준으로 봤을때 가장 점수가 높았던 게임을 봐야하나?
- 그럼 게임의 점수는 어떻게 측정함?
- 밖으로 나온 에이전트 1명 당 500점?
- 모르겠음...............

#### 해결된 문제점
- 에포크 도는 회수가 잘못 계산되어있었음. 해결함
- GameModel에서 ResultViewerModel로 넘어갈때 이상있던거 해결함

#### 고민중
- 결과 좋은 내용 or 해당 MoveCount중에서 가장 점수가 높던 이동방법 or 완전 랜덤
- 이 중에 하나 고르게 해야하나?
- 내일은 Agent 기준이 아니라 Game 기준에서 점수를 측정하도록 바꿔야겠음